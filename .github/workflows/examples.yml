name: Validate Examples

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: 
      - master
  schedule:
      - cron: "0 0 * * *"
  paths:
      - examples/**

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    # Use docker to handle dependencies and prepend executables to PATH
    - name: Pull + retag docker image for Python (3.6) dependencies (quay.io/fenics)
      run: |
        docker pull mathematicalmichael/python:thesis
        docker tag mathematicalmichael/python:thesis python:thesis

    - name: Set up PATH for binaries
      run: echo "PATH=$(pwd)/bin:$PATH" >> $GITHUB_ENV

    - name: Generate examples with python
      run: |
        cd examples
        echo "setting NUM_SAMPLES to 10 for expedited testing purposes"
        sed -i 's|NUM_SAMPLES=500|NUM_SAMPLES=49|g' Makefile
        sed -i 's|_N500_|_N49_|g' Makefile
        make clean
        make
