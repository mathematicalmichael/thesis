name: Validate Figures

on:
  push:
    branches: [ main, develop ]
    paths:
      - "figures/**"
      - ".github/workflows/figures.yml"
  pull_request:
    branches: 
      - main
    paths:
      - "figures/**"
      - ".github/workflows/figures.yml"
  schedule:
      - cron: "0 0 * * *"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    # Use docker to handle dependencies and prepend executables to PATH
    - name: Pull + retag docker image for Python (3.6) dependencies (quay.io/fenics)
      run: |
        docker pull mathematicalmichael/python:thesis
        docker tag mathematicalmichael/python:thesis python:thesis

    - name: Set up PATH for binaries
      run: echo "PATH=$(pwd)/bin:$PATH" >> $GITHUB_ENV

    - name: Generate figures with python
      run: |
        cd figures
        echo "setting NUM_SAMPLES to 10 for expedited testing purposes"
        sed -i 's|NUM_SAMPLES=1000|NUM_SAMPLES=10|g' generate_pde_data.sh
        make
